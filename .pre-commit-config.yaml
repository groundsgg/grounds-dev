# Pre-commit configuration for Grounds Development Infrastructure
# Run local linting before commits
# yamllint disable rule:quoted-strings

repos:
  - repo: local
    hooks:
      - id: shellcheck
        args: [--severity=style]
        entry: shellcheck
        files: \.sh$
        language: system
        name: ShellCheck

      - id: yamllint
        args: [--config-file=.yamllint]
        entry: yamllint
        files: \.(yaml|yml)$
        language: system
        name: YAML Lint

      - id: check-yaml
        args: [--format=parsable]
        entry: yamllint
        files: \.(yaml|yml)$
        language: system
        name: Check YAML

      - id: check-script-permissions
        args: [-c, 'test -x "$1" || (echo "Script $1 is not executable" && exit 1)']
        entry: bash
        files: \.sh$
        language: system
        name: Check Script Permissions

      - id: check-makefile
        args: [help]
        entry: make
        files: ^Makefile$
        language: system
        name: Check Makefile

      - id: check-k3d-config
        args: [-c, 'k3d cluster create test --config cluster/k3d.yaml --dry-run || exit 1']
        entry: bash
        files: ^cluster/k3d\.yaml$
        language: system
        name: Check k3d Configuration

      - id: check-helm-charts
        args: [lint]
        entry: helmfile
        files: ^helmfile\.yaml$
        language: system
        name: Check Helm Charts

      - id: check-kubernetes-manifests
        args: [apply, --dry-run=client, --validate=true]
        entry: kubectl
        files: ^manifests/.*\.yaml$
        language: system
        name: Check Kubernetes Manifests

      - id: check-documentation
        args: [-c, 'test -f README.md || (echo "README.md not found" && exit 1)']
        entry: bash
        files: ^README\.md$
        language: system
        name: Check Documentation

      - id: check-security
        args: [-c, 'grep -r -i "password\|secret\|key" . --exclude-dir=.git --exclude="*.md" | grep -v "app/app" | grep -v "localhost" && (echo "Potential hardcoded secrets found" && exit 1) || true']
        entry: bash
        files: \.(sh|yaml|yml)$
        language: system
        name: Security Scan
